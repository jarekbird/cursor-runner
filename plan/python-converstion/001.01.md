# TASK-PY-001.01: Verify Node.js Repository State and Capture Commit SHA

**Section**: 1. Baseline & Preparation
**Subsection**: 1.1.1
**Task ID**: TASK-PY-001.01
**Parent Task**: TASK-PY-001
**Order**: 1 of 4 (First subtask in TASK-PY-001)

## Description

This subtask verifies the Node.js `cursor-runner` repository is in a clean, known state and captures the exact commit SHA that will serve as the reference point for the Python port. This establishes the baseline commit that all porting work will reference.

**Reference Implementation**: `VirtualAssistant/cursor-runner`, `assistant-integrations/cursor-runner`

## Important Instructions

### Deploy Script Setup

Create a `deploy.sh` file in the root `cursor-executor` directory if it doesn't already exist. Model this file after the `cursor-runner/deploy.sh` file. It should run linting, automated tests if they exist, and then deploy to production in the `cursor-executor/cursor-executor-back` application.

### Critical Pre-Task Requirements

**IMPORTANT**: Before beginning any prompt, you MUST clear all git changes (staged and unstaged) in the repository and pull the latest changes from origin. Use `git reset --hard HEAD` to discard all local changes, `git clean -fd` to remove untracked files, and then `git pull` to fetch and merge the latest changes from the remote repository. This ensures a clean, up-to-date working state before starting any task.

**IMPORTANT**: If you push any code to origin during this task, you MUST explicitly report this in your output. State clearly: "Code pushed to origin" or "No code pushed to origin" at the end of your response. This information is critical for task completion tracking.

**IMPORTANT**: When a task file is referenced (e.g., "task at path/to/file.md"), you MUST output all sections labeled as definition of done from that task file in your response if it has one. Include the definition of done section from the task file in your output, in addition to any other work you perform. This helps verify that the task requirements are being met.

**IMPORTANT**: When updating system settings (SystemSetting model), you MUST use the cursor-runner-shared-sqlite MCP connection.

**IMPORTANT**: When working with agent tasks (creating, querying, updating, or deleting agent tasks), you MUST use the cursor-runner-shared-sqlite MCP connection. The agent tasks table is in the shared SQLite database at `/app/shared_db/shared.sqlite3`.

**IMPORTANT**: When working with conversation history in Redis (clearing, querying, or managing conversations), you MUST use the cursor-runner-shared-redis MCP connection. Conversation history is stored in Redis with keys like:
- `cursor:conversation:{conversationId}` - Individual conversation data
- `cursor:last_conversation_id` - Last conversation ID
To clear all conversation history, use Redis commands to delete keys matching the pattern `cursor:conversation:*` and `cursor:last_conversation_id`.

### Agent Tasks Table Schema

- `id`: INTEGER PRIMARY KEY AUTOINCREMENT
- `prompt`: TEXT NOT NULL (the agent task prompt/description to be executed)
- `status`: INTEGER NOT NULL DEFAULT 0 (agent task status enum: 0=ready, 1=complete, 2=archived, 3=backlogged, 4=in_progress)
- `createdat`: DATETIME DEFAULT CURRENT_TIMESTAMP
- `updatedat`: DATETIME DEFAULT CURRENT_TIMESTAMP
- `order`: INTEGER DEFAULT 0 (lower numbers are processed first)
- `uuid`: TEXT (unique identifier, indexed)

### Agent Task Status Values

- `0` = ready (ready to be processed by task operator)
- `1` = complete (agent task has been completed)
- `2` = archived (agent task has been archived)
- `3` = backlogged (agent task is in backlog, not ready for processing)
- `4` = in_progress (agent task is currently being processed)

### Agent Task Management Examples

- To create a ready agent task: `INSERT INTO tasks (prompt, "order", status) VALUES ('your prompt here', 0, 0)`
- To list ready agent tasks: `SELECT * FROM tasks WHERE status = 0 ORDER BY "order" ASC, id ASC`
- To mark an agent task as complete: `UPDATE tasks SET status = 1, updatedat = CURRENT_TIMESTAMP WHERE id = ?`
- To archive an agent task: `UPDATE tasks SET status = 2, updatedat = CURRENT_TIMESTAMP WHERE id = ?`
- To backlog an agent task: `UPDATE tasks SET status = 3, updatedat = CURRENT_TIMESTAMP WHERE id = ?`
- To get next ready agent task: `SELECT * FROM tasks WHERE status = 0 ORDER BY "order" ASC, id ASC LIMIT 1`

The task operator agent (when enabled) automatically processes agent tasks with `status = 0` (ready), sending the prompt to cursor-runner for execution.

**CRITICAL**: DO NOT create agents or agent tasks that process agent tasks from the database. The task operator already handles this automatically. Creating agents or agent tasks with prompts like "Process ready agent tasks", "Query the agent tasks table", or "Send agent task prompts to cursor-runner" will create recursive loops and is strictly forbidden. If you need to process agent tasks, ensure the `task_operator` system setting is enabled - do not create additional agents or agent tasks for this purpose.

### Cursor Agents Management

**IMPORTANT**: When working with cursor-agents (creating, listing, getting status, or deleting agents), use the Python scripts in `/cursor/tools/cursor-agents/` directory. These scripts communicate with the cursor-agents service over HTTP:

**Agent Management:**
- To list all agents: `python3 /cursor/tools/cursor-agents/list_agents.py`
- To get agent status: `python3 /cursor/tools/cursor-agents/get_agent_status.py --name <agent-name>`
- To create an agent: `python3 /cursor/tools/cursor-agents/create_agent.py --name <name> --target-url <url> [options]`
  - Use `--queue <queue-name>` to assign the agent to a specific queue (defaults to "default" if not specified)
  - Use `--schedule <cron-pattern>` for recurring agents (e.g., "0 8 * * *" for daily at 8 AM)
  - Use `--one-time` for one-time agents that run immediately
  - **CRITICAL**: Never create agents with prompts about processing tasks - the task operator handles this automatically
- To delete an agent: `python3 /cursor/tools/cursor-agents/delete_agent.py --name <agent-name>`

**Queue Management:**
- To list all queues: `python3 /cursor/tools/cursor-agents/list_queues.py`
- To get queue info: `python3 /cursor/tools/cursor-agents/get_queue_info.py --queue-name <queue-name>`
- To delete an empty queue: `python3 /cursor/tools/cursor-agents/delete_queue.py --queue-name <queue-name>`
  - Note: Cannot delete the "default" queue or queues with active jobs

**Task Operator Lock Management:**
- To release the task operator lock (when user requests it): `python3 /cursor/tools/cursor-agents/clear_task_operator_lock.py`
  - Use this when the user explicitly asks to release the task operator lock
  - **WARNING**: Only use this if you're sure no task is currently being processed, as clearing the lock while a task is in progress could cause issues

When creating an agent, the target URL should be the cursor-runner docker networked URL (`http://cursor-runner:3001/cursor/iterate/async`) with a prompt that this agent will later execute. However, DO NOT create agents for processing tasks - use the task operator system setting instead.

**Queue Organization**: Agents can be organized into queues to avoid queue bloat. By default, agents are created in the "default" queue. Use descriptive queue names like "daily-tasks", "hourly-sync", or "urgent-jobs" to group related agents together.

**IMPORTANT**: When creating one-time scripts (shell scripts, Python scripts, etc.), place them in `/cursor/scripts`. This directory is shared and persistent across container restarts. Do not create scripts in the repository directories or other temporary locations.

## Current State

- No baseline commit SHA has been recorded
- The current state of Node.js repositories is unknown
- Git status of reference repositories is unknown

**Important**: This is the first subtask and must be completed before any other work begins.

## Checklist

### Preparation and Setup

- [ ] Identify the canonical Node.js repository location (`VirtualAssistant/cursor-runner`)
- [ ] Verify git is available and working
- [ ] Navigate to the repository directory

### Implementation Steps

- [ ] Step 1: Check repository state
  - [ ] Navigate to `VirtualAssistant/cursor-runner`
  - [ ] Run `git status` to check for uncommitted changes
  - [ ] Document any uncommitted changes found
- [ ] Step 2: Capture commit information
  - [ ] Run `git rev-parse HEAD` to get current commit SHA
  - [ ] Run `git branch --show-current` to get branch name
  - [ ] Record current date/time
  - [ ] Run `git log -1 --format="%H %s"` to get commit message
- [ ] Step 3: Verify repository is valid
  - [ ] Verify commit SHA is a valid 40-character hash
  - [ ] Verify branch exists
  - [ ] Check that repository has commit history

### Specific Requirements

- [ ] Requirement 1: Clean repository state
  - Acceptance criteria: `git status` shows clean working tree OR uncommitted changes are documented
  - Acceptance criteria: No critical uncommitted changes that would affect porting
- [ ] Requirement 2: Valid commit SHA captured
  - Acceptance criteria: Commit SHA is a valid 40-character hexadecimal string
  - Acceptance criteria: Commit SHA can be checked out successfully
- [ ] Requirement 3: Information recorded
  - Acceptance criteria: Commit SHA, branch name, and date are recorded
  - Acceptance criteria: Information is stored in a retrievable format

### Error Handling and Edge Cases

- [ ] Handle case where repository doesn't exist: Document error and identify alternative
- [ ] Handle case where git is not initialized: Document and use alternative method
- [ ] Handle case where uncommitted changes exist: Document them with justification for ignoring
- [ ] Handle case where commit SHA is invalid: Re-verify and capture again

### Testing

- [ ] Verify commit SHA can be checked out: `git checkout <sha>`
- [ ] Verify commit SHA matches current HEAD: `git rev-parse HEAD`
- [ ] **DO NOT manually test by running the server** - this is a verification task only

### Documentation

- [ ] Record commit SHA, branch name, date in a text file or document
- [ ] Document any uncommitted changes found
- [ ] Document which repository was used as primary reference

### Verification

- [ ] Verify commit SHA is valid and can be checked out
- [ ] Verify all information is accurately recorded
- [ ] Verify repository state is suitable for porting

## Notes

- This subtask is part of TASK-PY-001
- **Execution Timing**: Must be executed first, before all other tasks
- **Dependencies**: None
- **Important Considerations**: 
  - The commit SHA is critical - it must be accurate
  - Uncommitted changes should be minimal or documented
  - This establishes the reference point for all porting work
- **Task Independence**: This subtask can be completed independently

## Related Tasks

- Parent: TASK-PY-001 (Confirm Baseline `cursor-runner` State)
- Next: TASK-PY-001.02 (Run Node.js Tests and Verify They Pass)
- Dependencies: None

## Definition of Done

This task involves **documentation and verification** work.

**Description**: Tasks that involve creating or updating documentation files and verification.

**Definition of Done**: "Commit SHA and repository state information are recorded and committed to git"

**User Stories**:
- As a **developer porting to Python**, I need a recorded commit SHA so I can always reference the exact Node.js state being ported
- As a **developer**, I need to know the repository state so I can trust the reference implementation

**Automated Tests**:
- Test that commit SHA is valid format (40 hex characters)
- Test that commit SHA can be checked out
- Test that recorded information is complete

**Commit and Push Requirements**:
- [ ] Create baseline note file with commit SHA and repository state
- [ ] Commit: `git add plan/python-converstion/baseline.md && git commit -m "TASK-PY-001.01: Capture Node.js repository baseline commit SHA"`
- [ ] Push to origin: `git push origin <branch-name>`
- [ ] Verify commit appears in remote repository

**Completion Criteria**:
- [ ] Commit SHA is captured and recorded
- [ ] Repository state is verified and documented
- [ ] Information is committed to git
- [ ] Commit SHA can be successfully checked out

