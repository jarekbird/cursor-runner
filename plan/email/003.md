# TASK-EML-003: Add Gmail MCP Dependency to cursor-runner Tooling

**Section**: 4, 7.1 (Gmail MCP dependency)  
**Subsection**: 4.1, 7.1  
**Task ID**: TASK-EML-003

## Description

This task involves adding the Gmail MCP server as a dependency to the `cursor-runner` project, ensuring it is installed and available in both local development and Docker environments. The Gmail MCP server binary must be on the PATH and accessible when cursor CLI runs, so that cursor can discover and use Gmail MCP tools.

This is a prerequisite for TASK-EML-004 (MCP configuration), as the MCP server must be installed before it can be configured.

**Reference Implementation**: 
- `cursor-runner/package.json` (for npm dependencies)
- `cursor-runner/Dockerfile` (for Docker installation)
- `cursor-runner/README.md` (for documentation patterns)

## Current State

- **No Gmail MCP Server**: The Gmail MCP server is not currently installed in `cursor-runner`
- **Existing Dependencies**: `cursor-runner` uses `package.json` for Node.js dependencies
- **Docker Setup**: `cursor-runner` has a `Dockerfile` for containerized deployment
- **MCP Servers**: Other MCP servers may be installed (e.g., `mcp-server-sqlite-npx`, `mcp-server-redis`)
- **Dependencies**: TASK-EML-002 should be completed to know which Gmail MCP implementation to use

**Important**: This task must be completed before TASK-EML-004, as the MCP server must be installed before it can be configured in `mcp.json`.

## Checklist

### Preparation and Setup

- [ ] Review TASK-EML-002 output (`config.md`) to understand Gmail MCP requirements
- [ ] Research available Gmail MCP server implementations:
  - [ ] Official `@modelcontextprotocol/server-gmail` npm package
  - [ ] Alternative implementations or forks
  - [ ] Version compatibility with cursor CLI
- [ ] Review `cursor-runner/package.json` to understand dependency management
- [ ] Review `cursor-runner/Dockerfile` to understand installation patterns
- [ ] Review `cursor-runner/README.md` to understand documentation patterns
- [ ] Check if other MCP servers are installed via npm or system packages
- [ ] Determine installation method (npm package, global install, or binary)

### Implementation Steps

- [ ] Step 1: Choose Gmail MCP implementation
  - [ ] Evaluate `@modelcontextprotocol/server-gmail` (or chosen package)
  - [ ] Check version compatibility with cursor CLI
  - [ ] Verify it supports the credential mechanism chosen in TASK-EML-002
  - [ ] Document decision in code comments
- [ ] Step 2: Add to package.json (local dev)
  - [ ] Add Gmail MCP server as dev dependency in `cursor-runner/package.json`:
    - [ ] Option A: `npm install --save-dev @modelcontextprotocol/server-gmail`
    - [ ] Option B: Document global install command if not using npm package
  - [ ] Pin version number for reproducibility
  - [ ] Run `npm install` to verify installation works
- [ ] Step 3: Update Dockerfile (Docker builds)
  - [ ] Review `cursor-runner/Dockerfile` structure
  - [ ] Add installation step for Gmail MCP server:
    - [ ] If npm package: Add `RUN npm install -g @modelcontextprotocol/server-gmail` or include in package.json
    - [ ] If binary: Add download/install steps
  - [ ] Ensure binary is on PATH in container
  - [ ] Verify installation in Docker build
- [ ] Step 4: Add verification script
  - [ ] Create npm script in `cursor-runner/package.json`:
    - [ ] `"mcp:gmail:version": "mcp-server-gmail --version || echo 'Gmail MCP server not found'"`
  - [ ] Or create standalone script in `cursor-runner/scripts/check-gmail-mcp.sh`
  - [ ] Script should exit 0 if Gmail MCP is available, non-zero if missing
- [ ] Step 5: Update documentation
  - [ ] Update `cursor-runner/README.md` with Gmail MCP installation instructions
  - [ ] Document local setup steps (npm install or global install)
  - [ ] Document Docker setup (automatic via Dockerfile)
  - [ ] Add troubleshooting section for installation issues

### Specific Requirements

- [ ] Requirement 1: Local Development Installation
  - [ ] **Acceptance Criteria**: Gmail MCP server is installable via `npm install` in `cursor-runner`
  - [ ] **Acceptance Criteria**: Binary is available on PATH after installation
  - [ ] **Acceptance Criteria**: `npm run mcp:gmail:version` (or equivalent) succeeds
  - [ ] **Acceptance Criteria**: Installation steps are documented in README
- [ ] Requirement 2: Docker Installation
  - [ ] **Acceptance Criteria**: Gmail MCP server is installed in Docker image build
  - [ ] **Acceptance Criteria**: Binary is on PATH in container
  - [ ] **Acceptance Criteria**: Docker build succeeds without errors
  - [ ] **Acceptance Criteria**: Container can run `mcp-server-gmail --version` successfully
- [ ] Requirement 3: Verification
  - [ ] **Acceptance Criteria**: Verification script/command exists and works
  - [ ] **Acceptance Criteria**: CI or local check can verify installation
  - [ ] **Acceptance Criteria**: Clear error message if Gmail MCP is missing

### Error Handling and Edge Cases

- [ ] Handle npm install failures: Document troubleshooting steps
- [ ] Handle version conflicts: Pin version and document compatibility
- [ ] Handle PATH issues: Ensure binary is accessible
- [ ] Handle Docker build failures: Provide clear error messages
- [ ] Handle missing binary at runtime: Verification script should detect this

### Testing

- [ ] Write unit/integration test for verification script:
  - [ ] Test script succeeds when Gmail MCP is installed
  - [ ] Test script fails with clear message when Gmail MCP is missing
- [ ] Test local installation:
  - [ ] Run `npm install` in `cursor-runner` directory
  - [ ] Verify Gmail MCP server is installed
  - [ ] Run verification script/command
  - [ ] Verify binary is on PATH
- [ ] Test Docker installation:
  - [ ] Build Docker image: `docker build -t cursor-runner .`
  - [ ] Run container: `docker run --rm cursor-runner mcp-server-gmail --version`
  - [ ] Verify command succeeds
- [ ] Run full test suite: `npm test` in `cursor-runner`
- [ ] Run type checking: `npm run type-check` (if applicable)
- [ ] Run linting: `npm run lint`
- [ ] Verify test coverage: `npm run test:coverage` (if applicable)
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Update `cursor-runner/package.json` with Gmail MCP dependency (if using npm)
- [ ] Update `cursor-runner/Dockerfile` with installation steps
- [ ] Update `cursor-runner/README.md` with:
  - [ ] Gmail MCP installation instructions
  - [ ] Verification steps
  - [ ] Troubleshooting section
- [ ] Add code comments explaining installation method
- [ ] Document version pinning rationale

### Verification

- [ ] Verify Gmail MCP is installable locally
- [ ] Verify Gmail MCP is installable in Docker
- [ ] Verify binary is on PATH in both environments
- [ ] Verify verification script works
- [ ] Verify documentation is complete
- [ ] Verify no regressions in existing functionality

## Notes

- This task is part of the **Email Integration Master Plan - Phase 2: Implementation**
- **Execution Timing**: Must be completed after TASK-EML-002 and before TASK-EML-004
- **Dependencies**: 
  - TASK-EML-002: Need to know which Gmail MCP implementation to use
- **Important Considerations**: 
  - Version pinning is important for reproducibility
  - PATH configuration is critical - binary must be accessible
  - Docker installation should match local installation method
  - Consider both development and production Docker images
  - Installation should be automated, not manual
- **Task Independence**: Can be completed independently after TASK-EML-002
- **Current State**: Gmail MCP server is not installed; this task adds it

## Related Tasks

- Previous: TASK-EML-002 (Define Gmail Secrets and Configuration Contract)
- Next: TASK-EML-004 (Extend Cursor MCP Configuration with Gmail Server)
- Dependencies:
  - TASK-EML-002: Provides Gmail MCP implementation choice
- Related:
  - TASK-EML-004: Will configure the installed Gmail MCP server
  - TASK-EML-005: Will wire env vars needed by Gmail MCP server

## Definition of Done

This is a **SYSTEM/ENVIRONMENT OPERATION TASK** (Type 2) with **CONFIGURATION TASK** (Type 5) components.

### User Stories Validation

- [ ] **As a developer**: Gmail MCP server is installed and available in local development environment via `npm install`, and verification confirms it's working
- [ ] **As a DevOps engineer**: Gmail MCP server installation is fully automated in Docker builds, and the binary is available on PATH in containers

### Installation Requirements

- [ ] **Local Development**:
  - [ ] Gmail MCP server is added to `cursor-runner/package.json` as dev dependency (or installation method is documented)
  - [ ] Running `npm install` in `cursor-runner` successfully installs Gmail MCP server
  - [ ] Binary `mcp-server-gmail` (or equivalent) is available on PATH after installation
  - [ ] Verification script/command (`npm run mcp:gmail:version` or equivalent) succeeds
- [ ] **Docker Environment**:
  - [ ] `cursor-runner/Dockerfile` includes steps to install Gmail MCP server
  - [ ] Docker build completes successfully: `docker build -t cursor-runner .`
  - [ ] Binary is on PATH in container
  - [ ] Container can run `mcp-server-gmail --version` successfully
  - [ ] No installation errors or warnings in Docker build output

### Automated Tests

- [ ] Unit/integration test for verification script:
  - [ ] Test passes when Gmail MCP is installed
  - [ ] Test fails with clear message when Gmail MCP is missing
- [ ] Docker build test:
  - [ ] Docker image builds successfully
  - [ ] Container can execute Gmail MCP server command
- [ ] All existing tests in `cursor-runner` still pass: `npm test`
- [ ] Type checking passes: `npm run type-check` (if applicable)
- [ ] Linting passes: `npm run lint`
- [ ] Test coverage meets project requirements (if applicable)

### Documentation Requirements

- [ ] `cursor-runner/README.md` includes:
  - [ ] Gmail MCP installation instructions for local development
  - [ ] Verification steps
  - [ ] Troubleshooting section for common installation issues
- [ ] `cursor-runner/package.json` includes Gmail MCP dependency (if using npm) or installation command is documented
- [ ] `cursor-runner/Dockerfile` includes Gmail MCP installation steps with comments

### Git Commit and Push

- [ ] All changes are committed to `cursor-runner` repository:
  - [ ] Commit message: `chore(email): add gmail mcp dependency to cursor-runner`
  - [ ] Files modified:
    - [ ] `cursor-runner/package.json` (if dependency added)
    - [ ] `cursor-runner/Dockerfile` (if installation steps added)
    - [ ] `cursor-runner/README.md` (if documentation added)
    - [ ] `cursor-runner/scripts/check-gmail-mcp.sh` (if verification script created)
  - [ ] Commit includes package-lock.json if package.json was modified
- [ ] Changes are pushed to origin: `git push origin <branch-name>`
- [ ] Push is verified (check remote repository to confirm)

### Final Verification

- [ ] Gmail MCP server is installable locally via `npm install`
- [ ] Gmail MCP server is installable in Docker build
- [ ] Binary is on PATH in both environments
- [ ] Verification script/command works
- [ ] All tests pass
- [ ] Documentation is complete
- [ ] No regressions introduced
- [ ] Task is ready for TASK-EML-004 to proceed
