# TASK-EML-001: Inventory Current Email/MCP Capabilities and Constraints

**Section**: 1–2 (Goal & Scope, Moving Pieces)  
**Subsection**: 1.1, 2.1  
**Task ID**: TASK-EML-001

## Description

This task involves creating a comprehensive inventory document that captures the current state of MCP (Model Context Protocol) configuration and email-related capabilities in the `cursor-runner` system. The goal is to understand how MCP servers are currently configured, how environment variables flow to the cursor CLI process, and what existing integrations exist before adding Gmail MCP support.

This documentation will serve as a reference for all subsequent Gmail integration tasks, ensuring we don't break existing functionality and understand the integration points clearly.

**Reference Implementation**: 
- `cursor-runner/mcp.json` (if exists)
- `cursor-runner/src/cursor-cli.ts` (lines related to env passing)
- `cursor-runner/src/workspace-trust-service.ts` (lines related to `.cursor/cli.json` creation)

## Current State

- **MCP Configuration**: The `cursor-runner` repository may have an `mcp.json` file that defines MCP servers (e.g., `cursor-runner-shared-sqlite`, `cursor-runner-shared-redis`). The exact location and structure need to be documented.
- **Workspace Trust**: The `WorkspaceTrustService` creates `.cursor/cli.json` files in workspace directories. We need to understand if this conflicts with or complements MCP configuration.
- **Environment Variables**: The `CursorCLI` class spawns cursor processes and passes environment variables. We need to verify how `process.env` is propagated.
- **Docker Setup**: The `cursor-runner` Dockerfile and docker-compose.yml (if they exist) configure the runtime environment. We need to document how services are wired.
- **No Gmail Integration**: Currently, there is no Gmail MCP server configured or any email-related integrations.

**Important**: This task must be completed first before any implementation tasks, as it establishes the baseline understanding of the system.

## Checklist

### Preparation and Setup

- [ ] Review `cursor-runner` repository structure to locate MCP configuration files
- [ ] Review `cursor-runner/src/cursor-cli.ts` to understand how cursor CLI is invoked
- [ ] Review `cursor-runner/src/workspace-trust-service.ts` to understand workspace trust setup
- [ ] Review `cursor-runner/Dockerfile` and `cursor-runner/docker-compose.yml` (if they exist)
- [ ] Review any existing documentation about MCP setup in cursor-runner
- [ ] Identify all files that reference MCP configuration or cursor CLI invocation
- [ ] Set up a local clone of `cursor-runner` repository for investigation

### Implementation Steps

- [ ] Step 1: Locate and analyze MCP configuration
  - [ ] Find `cursor-runner/mcp.json` (or equivalent MCP config file)
  - [ ] Document the structure of existing MCP server entries
  - [ ] Note the command, args, and env patterns used
  - [ ] Identify where this config is loaded/used in the codebase
- [ ] Step 2: Analyze cursor CLI invocation
  - [ ] Read `cursor-runner/src/cursor-cli.ts` to understand `CursorCLI` class
  - [ ] Document how `process.env` is passed to spawned cursor processes
  - [ ] Note any environment variable filtering or transformation
  - [ ] Document the command-line flags used (e.g., `--model auto --print --force`)
- [ ] Step 3: Analyze workspace trust service
  - [ ] Read `cursor-runner/src/workspace-trust-service.ts`
  - [ ] Document how `.cursor/cli.json` is created
  - [ ] Determine if this conflicts with or complements `mcp.json`
  - [ ] Note any permissions or security settings configured
- [ ] Step 4: Analyze Docker setup
  - [ ] Review `cursor-runner/Dockerfile` to understand container environment
  - [ ] Review `cursor-runner/docker-compose.yml` (if exists) for service configuration
  - [ ] Document how environment variables are passed to containers
  - [ ] Note any volume mounts or network configurations
- [ ] Step 5: Create inventory document
  - [ ] Create `assistant-integrations/cursor-runner/plan/email/current-state.md`
  - [ ] Document MCP configuration structure and location
  - [ ] Document environment variable flow from config → cursor process
  - [ ] Document existing MCP servers and their purposes
  - [ ] Document Docker/container setup relevant to MCP
  - [ ] Include code references (file paths, line numbers) for key findings
  - [ ] Add diagrams or flow charts if helpful

### Specific Requirements

- [ ] Requirement 1: MCP Configuration Inventory
  - [ ] **Acceptance Criteria**: Document identifies exact location of MCP config file(s)
  - [ ] **Acceptance Criteria**: All existing MCP server entries are listed with their command, args, and env patterns
  - [ ] **Acceptance Criteria**: Document explains how MCP config is loaded and used by cursor-runner
- [ ] Requirement 2: Environment Variable Flow Documentation
  - [ ] **Acceptance Criteria**: Document traces how env vars flow from `.env` → `system-settings.ts` → `CursorCLI` → cursor process
  - [ ] **Acceptance Criteria**: Document identifies any env var filtering or transformation
  - [ ] **Acceptance Criteria**: Document notes which env vars are required vs optional
- [ ] Requirement 3: Workspace Trust Analysis
  - [ ] **Acceptance Criteria**: Document explains relationship between `.cursor/cli.json` and `mcp.json`
  - [ ] **Acceptance Criteria**: Document identifies any potential conflicts or overlaps
  - [ ] **Acceptance Criteria**: Document notes security/permissions implications

### Error Handling and Edge Cases

- [ ] Handle case where `mcp.json` doesn't exist: Document that it needs to be created
- [ ] Handle case where MCP config is in a different location: Document actual location found
- [ ] Handle case where `docker-compose.yml` doesn't exist: Note that env vars may be set differently
- [ ] Handle case where workspace trust service doesn't create `.cursor/cli.json`: Document actual behavior

### Testing

- [ ] No automated tests required; this is a documentation task
- [ ] Manual verification: Review the created `current-state.md` document for completeness and accuracy
- [ ] Peer review: Have another developer review the document to ensure it captures all relevant information

### Documentation

- [ ] Create `assistant-integrations/cursor-runner/plan/email/current-state.md` with comprehensive inventory
- [ ] Include code references (file paths, line numbers) for all findings
- [ ] Add diagrams showing environment variable flow if helpful
- [ ] Document any assumptions or uncertainties that need to be resolved in later tasks
- [ ] Update `assistant-integrations/cursor-runner/plan/email/execution-order.md` to reference this document

### Verification

- [ ] Verify all MCP-related files in cursor-runner have been reviewed
- [ ] Verify environment variable flow is fully documented
- [ ] Verify document is clear and actionable for subsequent tasks
- [ ] Verify no critical information is missing

## Notes

- This task is part of the **Email Integration Master Plan - Phase 1: Discovery and Planning**
- **Execution Timing**: This must be the first task executed before any implementation tasks
- **Dependencies**: None - this is the starting point
- **Important Considerations**: 
  - The inventory document will be referenced by all subsequent tasks
  - Accuracy is critical - incorrect assumptions here will cause problems later
  - If MCP config doesn't exist, we'll need to create it in a later task
  - Document any uncertainties clearly so they can be resolved in implementation tasks
- **Task Independence**: This task can be completed independently and doesn't require coordination with other tasks
- **Current State**: No Gmail integration exists; this task establishes baseline understanding

## Related Tasks

- Previous: None (this is the first task)
- Next: TASK-EML-002 (Define Gmail Secrets and Configuration Contract)
- Dependencies: None
- Related:
  - TASK-EML-004: Will use this inventory to understand where to add Gmail MCP config
  - TASK-EML-005: Will use this inventory to understand env var flow

## Definition of Done

This is a **DOCUMENTATION TASK** (Type 3).

### User Stories Validation

- [ ] **As a developer**: The inventory document provides clear, written information about MCP configuration, cursor CLI invocation, and env var flow that enables safe addition of Gmail without breaking existing functionality
- [ ] **As an operator**: The inventory document explains which components (Docker, cursor config, env vars) are touched by Gmail integration

### Documentation Requirements

- [ ] `assistant-integrations/cursor-runner/plan/email/current-state.md` exists and contains:
  - [ ] Location and structure of MCP configuration file(s)
  - [ ] Complete list of existing MCP servers with their configurations
  - [ ] Documentation of how environment variables flow from config to cursor process
  - [ ] Analysis of workspace trust service and `.cursor/cli.json` creation
  - [ ] Documentation of Docker/container setup relevant to MCP
  - [ ] Code references (file paths, line numbers) for all key findings
  - [ ] Any assumptions or uncertainties clearly marked
- [ ] Document is accurate, complete, and reviewed for clarity

### Git Commit and Push

- [ ] All changes are committed to `assistant-integrations/cursor-runner` repository
- [ ] Commit message follows format: `docs(email): capture current mcp/email integration state`
- [ ] Commit includes:
  - [ ] `assistant-integrations/cursor-runner/plan/email/current-state.md` (new file)
  - [ ] Any updates to `assistant-integrations/cursor-runner/plan/email/execution-order.md` if references were added
- [ ] Changes are pushed to origin: `git push origin <branch-name>`
- [ ] Push is verified (check remote repository to confirm)

### Final Verification

- [ ] Document exists in the repository at the expected path
- [ ] Document is accessible and readable
- [ ] All acceptance criteria from Specific Requirements section are met
- [ ] No regressions introduced (N/A for documentation-only task)
- [ ] Task is ready for next task (TASK-EML-002) to proceed
