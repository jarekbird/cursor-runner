# TASK-EML-006: Define Gmail-Focused Prompt Templates and Capabilities

**Section**: 5 (Prompt & Tooling Conventions)  
**Subsection**: 5.1, 5.2, 5.3  
**Task ID**: TASK-EML-006

## Description

This task involves creating a comprehensive library of reusable Gmail prompt templates and capability descriptions that explicitly instruct AI agents to use Gmail MCP tools. These templates will be used by agents, tasks, and workflows to interact with Gmail in a consistent, safe manner.

The templates must be compatible with the system instructions that `cursor-runner` appends to prompts, and should avoid direct API details, instead directing agents to use the Gmail MCP tools.

**Reference Implementation**: 
- `cursor-runner/src/cursor-execution-service.ts` (for system instructions pattern)
- Existing prompt templates in `cursor-runner` or related projects (if any)
- Gmail MCP server documentation (for available tools)

## Current State

- **No Gmail Prompts**: No Gmail-focused prompt templates exist
- **System Instructions**: `cursor-runner` appends system instructions to prompts (see `SYSTEM_SETTINGS_MCP_INSTRUCTIONS`)
- **MCP Tools Available**: Gmail MCP server provides tools (listMessages, getMessage, sendReply, etc.) - need to reference these
- **Dependencies**: 
  - TASK-EML-001: Need to understand system instructions pattern
  - TASK-EML-004: Gmail MCP should be configured (tools available)

**Important**: This task can be completed in parallel with implementation tasks, as it's documentation-only. However, it should reference the actual Gmail MCP tools that will be available.

## Checklist

### Preparation and Setup

- [ ] Review `cursor-runner/src/cursor-execution-service.ts` to understand system instructions pattern
- [ ] Review Gmail MCP server documentation to understand available tools:
  - [ ] `listMessages` - list emails with filters
  - [ ] `getMessage` - get email details
  - [ ] `sendReply` - send email reply
  - [ ] Other available tools
- [ ] Review existing prompt patterns in `cursor-runner` (if any)
- [ ] Understand how prompts are structured in the system
- [ ] Review TASK-EML-001 output to understand MCP tool invocation patterns

### Implementation Steps

- [ ] Step 1: Document Gmail capabilities
  - [ ] Create `assistant-integrations/cursor-runner/plan/email/prompts-gmail.md`
  - [ ] Document high-level Gmail capabilities:
    - [ ] Read/summarize inbox messages
    - [ ] Draft and send email replies
    - [ ] Extract structured data (receipts, schedules, client details)
    - [ ] Auto-categorize and tag messages
  - [ ] For each capability, explain:
    - [ ] What it does
    - [ ] Which Gmail MCP tools are used
    - [ ] When to use it
- [ ] Step 2: Create prompt templates
  - [ ] Template 1: Summarize unread messages
    - [ ] Prompt: "Use the Gmail MCP tools to list recent unread messages in the PRIMARY inbox, then summarize each in 3 bullets."
    - [ ] Include parameters: time range, label filter, max messages
    - [ ] Include expected output format
  - [ ] Template 2: Draft reply for thread
    - [ ] Prompt: "Given thread ID {threadId}, use Gmail MCP tools to read the last 10 messages and draft a polite reply that {requirements}."
    - [ ] Include parameters: thread ID, message count, reply requirements
    - [ ] Include expected output format
  - [ ] Template 3: Extract receipts
    - [ ] Prompt: "Scan the last 30 days of emails labeled 'Receipts' and extract merchant, total, date into JSON format using Gmail MCP tools."
    - [ ] Include parameters: time range, label, extraction fields
    - [ ] Include expected JSON schema
  - [ ] Template 4: Categorize messages
    - [ ] Prompt: "Use Gmail MCP tools to list unread messages and categorize them as: urgent, important, informational, or spam."
    - [ ] Include categorization criteria
    - [ ] Include expected output format
  - [ ] Template 5: Extract client details
    - [ ] Prompt: "Use Gmail MCP tools to find emails from {clientEmail} and extract: contact info, project details, and recent communications into structured JSON."
    - [ ] Include parameters: client email, extraction fields
    - [ ] Include expected JSON schema
- [ ] Step 3: Ensure MCP tool references
  - [ ] Each template explicitly says "use the Gmail MCP tools"
  - [ ] Templates reference specific Gmail MCP tool names (listMessages, getMessage, etc.)
  - [ ] Templates avoid direct Gmail API details
  - [ ] Templates are compatible with system instructions appended by cursor-runner
- [ ] Step 4: Add usage examples
  - [ ] For each template, add:
    - [ ] Example prompt (filled in with sample values)
    - [ ] Expected Gmail MCP tool calls
    - [ ] Expected output format
    - [ ] Common variations or extensions
- [ ] Step 5: Document best practices
  - [ ] When to use each template
  - [ ] How to combine templates
  - [ ] Error handling in prompts
  - [ ] Security considerations (don't expose sensitive data)

### Specific Requirements

- [ ] Requirement 1: Capability Documentation
  - [ ] **Acceptance Criteria**: All high-level Gmail capabilities are documented
  - [ ] **Acceptance Criteria**: Each capability explains which MCP tools are used
  - [ ] **Acceptance Criteria**: Use cases are clear and actionable
- [ ] Requirement 2: Prompt Templates
  - [ ] **Acceptance Criteria**: At least 3-5 concrete prompt templates exist
  - [ ] **Acceptance Criteria**: Each template explicitly says "use the Gmail MCP tools"
  - [ ] **Acceptance Criteria**: Templates include parameters and expected outputs
  - [ ] **Acceptance Criteria**: Templates avoid direct API details
- [ ] Requirement 3: Compatibility
  - [ ] **Acceptance Criteria**: Templates are compatible with cursor-runner system instructions
  - [ ] **Acceptance Criteria**: Templates work with MCP tool invocation patterns
  - [ ] **Acceptance Criteria**: Templates are reviewed for clarity

### Error Handling and Edge Cases

- [ ] Handle missing messages: Templates should instruct agents to handle empty results
- [ ] Handle invalid thread IDs: Templates should include error handling guidance
- [ ] Handle rate limits: Templates should note Gmail API rate limits
- [ ] Handle authentication errors: Templates should reference credential setup

### Testing

- [ ] No automated code tests required; this is a documentation task
- [ ] Manual review: Templates should be reviewed for:
  - [ ] Clarity and completeness
  - [ ] Compatibility with system instructions
  - [ ] Correct Gmail MCP tool references
  - [ ] Actionability (can an agent actually use these?)
- [ ] Peer review: Have another developer review templates

### Documentation

- [ ] Create `assistant-integrations/cursor-runner/plan/email/prompts-gmail.md` with:
  - [ ] Gmail capabilities overview
  - [ ] Prompt templates (3-5 minimum)
  - [ ] Usage examples
  - [ ] Best practices
  - [ ] Security considerations
- [ ] Document how templates integrate with cursor-runner system instructions
- [ ] Reference Gmail MCP tool documentation

### Verification

- [ ] Verify all templates explicitly reference Gmail MCP tools
- [ ] Verify templates are compatible with system instructions
- [ ] Verify templates are clear and actionable
- [ ] Verify documentation is complete

## Notes

- This task is part of the **Email Integration Master Plan - Phase 2: Implementation**
- **Execution Timing**: Can be completed in parallel with other tasks, but should reference actual Gmail MCP tools
- **Dependencies**: 
  - TASK-EML-001: Need to understand system instructions pattern
  - TASK-EML-004: Gmail MCP should be configured (to know available tools)
- **Important Considerations**: 
  - Templates must explicitly say "use the Gmail MCP tools" - don't assume agents will infer this
  - Avoid direct Gmail API details - agents should use MCP tools, not make HTTP calls
  - Templates should be parameterized and reusable
  - Consider security - don't expose sensitive data in prompts
  - Templates should work with cursor-runner's system instructions
- **Task Independence**: Can be completed independently, but benefits from understanding MCP tools
- **Current State**: No Gmail prompt templates exist; this task creates them

## Related Tasks

- Previous: TASK-EML-001 (Inventory), TASK-EML-004 (MCP Config)
- Next: TASK-EML-007 (End-to-End Flows), TASK-EML-008 (Integration Tests)
- Dependencies:
  - TASK-EML-001: Provides system instructions understanding
  - TASK-EML-004: Provides Gmail MCP tool knowledge
- Related:
  - TASK-EML-007: Will use these templates in flow designs
  - TASK-EML-008: Integration tests may use these templates

## Definition of Done

This is a **DOCUMENTATION TASK** (Type 3).

### User Stories Validation

- [ ] **As an agent designer**: Reusable Gmail prompt templates exist that can be used without rediscovering best practices, enabling consistent Gmail interactions
- [ ] **As a VA operator**: Agents consistently use Gmail MCP tools rather than ad-hoc HTTP calls, ensuring proper integration and security

### Documentation Requirements

- [ ] `assistant-integrations/cursor-runner/plan/email/prompts-gmail.md` exists and contains:
  - [ ] High-level Gmail capabilities documentation (read/summarize, draft replies, extract data, categorize)
  - [ ] At least 3-5 concrete prompt templates:
    - [ ] Summarize unread messages template
    - [ ] Draft reply for thread template
    - [ ] Extract receipts template
    - [ ] Categorize messages template (optional)
    - [ ] Extract client details template (optional)
  - [ ] Each template includes:
    - [ ] Explicit "use the Gmail MCP tools" instruction
    - [ ] Parameters and placeholders
    - [ ] Expected output format
    - [ ] Usage example
  - [ ] Best practices section
  - [ ] Security considerations
  - [ ] Compatibility notes with cursor-runner system instructions
- [ ] Templates explicitly direct agents to use Gmail MCP tools (not direct API calls)
- [ ] Templates avoid direct Gmail API details
- [ ] Documentation is clear, complete, and actionable

### Review and Validation

- [ ] Templates are reviewed for clarity and completeness
- [ ] Templates are verified to be compatible with cursor-runner system instructions
- [ ] Templates are verified to reference correct Gmail MCP tool names
- [ ] Peer review completed (another developer reviewed templates)

### Git Commit and Push

- [ ] All changes are committed to `assistant-integrations/cursor-runner` repository:
  - [ ] Commit message: `docs(email): add gmail prompt templates and capabilities`
  - [ ] File: `assistant-integrations/cursor-runner/plan/email/prompts-gmail.md` (new file)
- [ ] Changes are pushed to origin: `git push origin <branch-name>`
- [ ] Push is verified (check remote repository to confirm)

### Final Verification

- [ ] Prompt library file exists with capabilities and templates
- [ ] All templates explicitly reference Gmail MCP tools
- [ ] Documentation is complete and actionable
- [ ] Templates are compatible with system instructions
- [ ] Task is ready for TASK-EML-007 and TASK-EML-008 to use these templates
