# TASK-16.1.1: Wrap test-mcp-connection.sh as Jest test

**Section**: 16. Shell Script Integration & CI
**Subsection**: 16.1.1
**Task ID**: TASK-16.1.1
**Parent Task**: TASK-16.1

## Description

Create a Jest test that wraps the `test-mcp-connection.sh` shell script. The test should spawn the script with non-interactive flags, assert exit code is 0, and optionally capture and verify output. This integrates shell-based tests into Jest.

**Reference Implementation**: `virtual-assistant/cursor-runner/scripts/test-mcp-connection.sh` (or similar script location)

## Current State

- `test-mcp-connection.sh` script exists
- Jest test infrastructure exists
- Test wrapper may not exist yet

**Important**: This test integrates shell script into Jest test suite.

## Checklist

### Preparation and Setup

- [ ] Review `test-mcp-connection.sh` script
- [ ] Review script arguments and non-interactive flags
- [ ] Review existing Jest test patterns
- [ ] Understand script output format

### Implementation Steps

- [ ] Step 1: Create test structure
  - [ ] Create or extend test file for shell script integration
  - [ ] Add test: `'test-mcp-connection.sh executes successfully'`
  - [ ] Use `describe` block for shell script integration tests
- [ ] Step 2: Set up script execution
  - [ ] Use `child_process.spawn` or `child_process.exec` to run script
  - [ ] Pass non-interactive flags to script
  - [ ] Capture stdout and stderr
- [ ] Step 3: Test script execution
  - [ ] Execute script and wait for completion
  - [ ] Verify exit code is 0
  - [ ] Optionally verify output contains expected content
- [ ] Step 4: Verify script integration
  - [ ] Assert exit code is 0
  - [ ] Assert script completes successfully

### Specific Requirements

- [ ] Requirement 1: Script executes successfully
  - Acceptance: Script runs without errors
  - Acceptance: Exit code is 0
- [ ] Requirement 2: Integration works
  - Acceptance: Script can be run from Jest
  - Acceptance: Output can be captured
- [ ] Requirement 3: Test is isolated
  - Acceptance: Test doesn't affect other tests

### Error Handling and Edge Cases

- [ ] Handle edge case 1: Script timeout (verify handling)

### Testing

- [ ] Write test in appropriate test file
- [ ] Run test: `npm run test:integration`
- [ ] Verify test passes
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests

### Documentation

- [ ] Add test comments explaining script integration

### Verification

- [ ] Verify test passes
- [ ] Verify script integration works correctly
- [ ] Verify no regressions in existing tests

## Notes

- This task is part of Phase 16: Shell Script Integration & CI
- **Execution Timing**: Must be completed after TASK-15.3.1
- **Dependencies**: TASK-15.3.1
- **Important Considerations**: 
  - Script should run non-interactively
  - Should handle script failures gracefully
- **Task Independence**: Can be done after TASK-15.3.1

## Related Tasks

- Previous: TASK-15.3.1
- Next: TASK-16.1.2
- Dependencies: TASK-15.3.1
- Related:
  - TASK-16.1: Wrap Shell Scripts as Jest Tests (parent task)

## Definition of Done

**Definition of Done**: 
1. Test is written in appropriate test file
2. Test passes
3. Script integration is verified
4. All checks pass (test, type-check, lint)
5. Code is committed to git with descriptive commit message
6. Code is pushed to origin

**User Stories**:
- As a **developer**, I want script integration so shell tests run in Jest
- As a **system**, I want integrated tests so all tests run together

**Automated Tests**:
- Test verifies script executes successfully
- Test passes
- All tests pass












