# TASK-16.2.1: Integrate Gmail smoke test as opt-in Jest test

**Section**: 16. Shell Script Integration & CI
**Subsection**: 16.2.1
**Task ID**: TASK-16.2.1
**Parent Task**: TASK-16.2

## Description

Extend `scripts/gmail_smoke_test.ts` or create a Jest wrapper to integrate the Gmail smoke test as an opt-in Jest test. Tag test with `@smoke` or similar, make it skip by default (use `describe.skip` or environment check), and document how to enable in CI with secrets.

**Reference Implementation**: `virtual-assistant/cursor-runner/scripts/gmail_smoke_test.ts`

## Current State

- `scripts/gmail_smoke_test.ts` exists
- Jest test infrastructure exists
- Opt-in test integration may not exist yet

**Important**: This test integrates Gmail smoke test as opt-in.

## Checklist

### Preparation and Setup

- [ ] Review `scripts/gmail_smoke_test.ts` implementation
- [ ] Review how to make test opt-in
- [ ] Review CI secret configuration
- [ ] Review existing Jest test patterns

### Implementation Steps

- [ ] Step 1: Create test structure
  - [ ] Create or extend test file for Gmail smoke test
  - [ ] Add test: `'Gmail smoke test'` (tagged with @smoke)
  - [ ] Use `describe.skip` or environment check to skip by default
- [ ] Step 2: Set up opt-in mechanism
  - [ ] Check for environment variable (e.g., `ENABLE_GMAIL_SMOKE_TEST`)
  - [ ] Skip test if environment variable not set
  - [ ] Document environment variable in test comments
- [ ] Step 3: Integrate smoke test
  - [ ] Import or call Gmail smoke test functionality
  - [ ] Execute smoke test when enabled
  - [ ] Verify smoke test passes
- [ ] Step 4: Document CI integration
  - [ ] Add comments explaining how to enable in CI
  - [ ] Document required secrets
  - [ ] Document environment variable usage

### Specific Requirements

- [ ] Requirement 1: Test is opt-in
  - Acceptance: Test is skipped by default
  - Acceptance: Test runs when enabled
- [ ] Requirement 2: CI integration is documented
  - Acceptance: Documentation explains how to enable
  - Acceptance: Secrets are documented
- [ ] Requirement 3: Test is isolated
  - Acceptance: Test doesn't affect other tests when skipped

### Error Handling and Edge Cases

- [ ] Handle edge case 1: Secrets missing (verify test is skipped gracefully)

### Testing

- [ ] Write test in appropriate test file
- [ ] Run test: `npm run test:smoke` (when enabled)
- [ ] Verify test is skipped by default
- [ ] Verify test runs when enabled
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests

### Documentation

- [ ] Add test comments explaining opt-in mechanism
- [ ] Document CI integration process

### Verification

- [ ] Verify test is skipped by default
- [ ] Verify test runs when enabled
- [ ] Verify no regressions in existing tests

## Notes

- This task is part of Phase 16: Shell Script Integration & CI
- **Execution Timing**: Must be completed after TASK-16.1.3
- **Dependencies**: TASK-16.1.3
- **Important Considerations**: 
  - Test should be opt-in (not run by default)
  - Should be easy to enable in CI
- **Task Independence**: Can be done after TASK-16.1.3

## Related Tasks

- Previous: TASK-16.1.3
- Next: TASK-16.3.1
- Dependencies: TASK-16.1.3
- Related:
  - TASK-16.2: Gmail Smoke Test Integration (parent task)

## Definition of Done

**Definition of Done**: 
1. Test is written in appropriate test file
2. Test is skipped by default
3. Test runs when enabled
4. CI integration is documented
5. All checks pass (test, type-check, lint)
6. Code is committed to git with descriptive commit message
7. Code is pushed to origin

**User Stories**:
- As a **developer**, I want opt-in smoke tests so I can test external services when needed
- As a **CI**, I want opt-in tests so I can run them with secrets

**Automated Tests**:
- Test verifies smoke test is skipped by default
- Test verifies smoke test runs when enabled
- Test passes
- All tests pass








