# TASK-14.2.2: Test Path traversal attempts are rejected

**Section**: 14. Filesystem & Workspace Services
**Subsection**: 14.2.2
**Task ID**: TASK-14.2.2
**Parent Task**: TASK-14.2

## Description

Write a test to verify that path traversal attempts (e.g., `../../../etc/passwd`) are rejected by filesystem services. This ensures security against directory traversal attacks.

**Reference Implementation**: `virtual-assistant/cursor-runner/src/filesystem-service.ts`, `src/file-tree-service.ts` (path validation)

## Current State

- FilesystemService, FileTreeService exist
- Path validation exists (or needs to be implemented)
- Test files exist
- Test for path traversal rejection may not exist yet

**Important**: This test verifies security - path traversal protection.

## Checklist

### Preparation and Setup

- [ ] Review filesystem service implementations
- [ ] Review path validation logic
- [ ] Review existing test files
- [ ] Use test filesystem mocking

### Implementation Steps

- [ ] Step 1: Create test structure
  - [ ] Add test: `'Path traversal attempts are rejected'`
  - [ ] Use appropriate test file
- [ ] Step 2: Test path traversal rejection
  - [ ] Test case 1: Call with `../../../etc/passwd` - verify rejection
  - [ ] Test case 2: Call with `..\\..\\windows\\system32` - verify rejection
  - [ ] Test case 3: Call with `./../secret` - verify rejection
  - [ ] Verify appropriate error is returned (400 or security error)
- [ ] Step 3: Verify path validation
  - [ ] Assert path traversal attempts are rejected
  - [ ] Assert appropriate error is returned
  - [ ] Assert security error message is clear

### Specific Requirements

- [ ] Requirement 1: Path traversal is rejected
  - Acceptance: Traversal attempts return error
  - Acceptance: Access is denied
- [ ] Requirement 2: Security is enforced
  - Acceptance: Various traversal patterns are rejected
- [ ] Requirement 3: Test is isolated
  - Acceptance: Test doesn't affect other tests

### Error Handling and Edge Cases

- [ ] Handle edge case 1: Encoded traversal attempts (verify handling)

### Testing

- [ ] Write test in appropriate test file
- [ ] Run test: `npm run test:integration`
- [ ] Verify test passes
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests

### Documentation

- [ ] Add test comments explaining security validation

### Verification

- [ ] Verify test passes
- [ ] Verify path traversal protection works correctly
- [ ] Verify no regressions in existing tests

## Notes

- This task is part of Phase 14: Filesystem & Workspace Services
- **Execution Timing**: Must be completed after TASK-14.2.1
- **Dependencies**: TASK-14.2.1
- **Important Considerations**: 
  - Path traversal is a security vulnerability
  - Should reject all traversal patterns
- **Task Independence**: Can be done after TASK-14.2.1

## Related Tasks

- Previous: TASK-14.2.1
- Next: TASK-14.2.3
- Dependencies: TASK-14.2.1
- Related:
  - TASK-14.2: FilesystemService, FileTreeService, WorkspaceTrustService (parent task)

## Definition of Done

**Definition of Done**: 
1. Test is written in appropriate test file
2. Test passes
3. Path traversal protection is verified
4. All checks pass (test, type-check, lint)
5. Code is committed to git with descriptive commit message
6. Code is pushed to origin

**User Stories**:
- As a **developer**, I want path traversal protection so the system is secure
- As a **system**, I want security validation so unauthorized access is prevented

**Automated Tests**:
- Test verifies path traversal attempts are rejected
- Test passes
- All tests pass

