# TASK-1.2.1: Update Jest Configuration for Coverage and Test Types

**Section**: 1. Foundation & Test Infrastructure
**Subsection**: 1.2.1
**Task ID**: TASK-1.2.1
**Parent Task**: TASK-1.2

## Description

Update `jest.config.js` to support coverage reporting with thresholds and ensure test configuration supports all test types (unit, integration, E2E-lite). This establishes the foundation for test organization and coverage tracking.

**Reference Implementation**: `virtual-assistant/cursor-runner/jest.config.js`

## Current State

- `jest.config.js` exists with basic configuration
- Coverage collection is configured but no thresholds are set
- `testTimeout` may need adjustment for integration tests
- Test match pattern exists but may need verification

**Important**: This must be completed before adding test scripts that depend on test type organization.

## Checklist

### Preparation and Setup

- [ ] Review current `jest.config.js` configuration
- [ ] Review Jest documentation for coverage thresholds
- [ ] Review existing test files to understand test types
- [ ] Understand test timeout requirements for integration tests

### Implementation Steps

- [ ] Step 1: Update coverage collection
  - [ ] Verify `collectCoverageFrom` includes `src/**/*.ts`
  - [ ] Ensure `index.ts` is excluded from coverage
  - [ ] Verify coverage directory is set
- [ ] Step 2: Add coverage thresholds
  - [ ] Add `coverageThresholds` configuration
  - [ ] Set conservative thresholds: `lines: 60, branches: 50, functions: 60, statements: 60`
  - [ ] Configure thresholds at global level
- [ ] Step 3: Verify test matching
  - [ ] Verify `testMatch` pattern matches all test files
  - [ ] Ensure pattern works for: `*.test.ts`, `*.test.js`, `*.spec.ts`
- [ ] Step 4: Configure test timeout
  - [ ] Add `testTimeout` configuration (suggest 10000ms for integration tests)
  - [ ] Consider per-test-type timeouts if needed

### Specific Requirements

- [ ] Requirement 1: Coverage thresholds must be set
  - Acceptance: Jest fails if coverage falls below thresholds
  - Acceptance: Thresholds are conservative to start
- [ ] Requirement 2: Test matching must work
  - Acceptance: All test files are discovered
  - Acceptance: No false positives or negatives
- [ ] Requirement 3: Timeout must be appropriate
  - Acceptance: Integration tests don't timeout prematurely
  - Acceptance: Unit tests still run quickly

### Error Handling and Edge Cases

- [ ] Handle edge case 1: Coverage on new files
  - New files should be included in coverage
- [ ] Handle edge case 2: Test file discovery
  - All test files in `tests/` directory should be found

### Testing

- [ ] Run `npm test` and verify all existing tests pass
- [ ] Run `npm run test:coverage` and verify coverage report generates
- [ ] Verify coverage thresholds are enforced (intentionally fail to test)
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Update code comments in `jest.config.js`
- [ ] Document coverage threshold rationale
- [ ] Document test timeout reasoning

### Verification

- [ ] Verify coverage report generates successfully
- [ ] Verify thresholds are enforced
- [ ] Verify test discovery works correctly
- [ ] Verify no regressions in existing tests

## Notes

- This task is part of Phase 1: Foundation & Test Infrastructure
- **Execution Timing**: Must be completed before TASK-1.2.2 (test scripts)
- **Dependencies**: None
- **Important Considerations**: 
  - Start with conservative thresholds - can be raised later
  - Test timeout should accommodate slow integration tests
  - Coverage thresholds will fail builds if not met
- **Task Independence**: Can be completed independently

## Related Tasks

- Previous: TASK-1.1.6
- Next: TASK-1.2.2
- Dependencies: None
- Related:
  - TASK-1.2: Test Configuration & Coverage Setup (parent task)
  - TASK-16.3: CI Configuration (will build on this)

## Definition of Done

This task involves CONFIGURATION changes.

**Definition of Done**: 
1. `jest.config.js` is updated with coverage thresholds
2. Test timeout is configured appropriately
3. Test matching is verified
4. Coverage report generates successfully
5. All existing tests still pass
6. Code is committed to git with descriptive commit message
7. Code is pushed to origin

**User Stories**:
- As a **developer**, I want coverage thresholds so I know when test coverage is insufficient
- As a **developer**, I want appropriate test timeouts so integration tests don't fail prematurely
- As a **CI system**, I want coverage enforcement so builds fail when coverage drops

**Automated Tests**:
- Verify coverage report generates: `npm run test:coverage`
- Verify thresholds are enforced (test by temporarily lowering threshold)
- Verify all tests still pass: `npm test`
- All checks must pass before task is complete








