# TASK-1.1.5: Create assertErrorResponse() Helper

**Section**: 1. Foundation & Test Infrastructure
**Subsection**: 1.1.5
**Task ID**: TASK-1.1.5
**Parent Task**: TASK-1.1

## Description

Create a helper function for validating error response shapes from HTTP endpoints. This ensures consistent error response validation across all tests and makes test code more readable.

## Current State

- Tests currently validate error responses manually
- No standardized error response validation exists
- Error responses should have consistent structure (status, error, message, etc.)

## Checklist

### Preparation and Setup

- [ ] Review existing error responses in server routes
- [ ] Identify common error response structure
- [ ] Review existing tests that validate errors

### Implementation Steps

- [ ] Step 1: Create function signature
  - [ ] Add `assertErrorResponse()` to `tests/test-utils.ts`
  - [ ] Accept: response object (from supertest), expected status code, optional expected message
  - [ ] Return: void (throws if assertion fails)
- [ ] Step 2: Implement validation
  - [ ] Verify status code matches expected
  - [ ] Verify response has error field
  - [ ] Verify response has message field (if expected message provided)
  - [ ] Verify response structure is valid JSON
- [ ] Step 3: Add helpful error messages
  - [ ] Provide descriptive assertion errors
  - [ ] Show actual vs expected values

### Specific Requirements

- [ ] Requirement 1: Validates status code
  - Acceptance: Fails if status code doesn't match
- [ ] Requirement 2: Validates response structure
  - Acceptance: Verifies error and message fields exist
- [ ] Requirement 3: Optional message matching
  - Acceptance: Can optionally verify error message content

### Testing

- [ ] Write unit tests
  - [ ] Test: Validates correct error response
  - [ ] Test: Fails on wrong status code
  - [ ] Test: Fails on missing error field
  - [ ] Test: Validates message when provided
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`

### Documentation

- [ ] Add JSDoc with usage examples
- [ ] Document all parameters

### Verification

- [ ] Verify validation works correctly
- [ ] Verify helpful error messages
- [ ] Verify can be used in tests

## Notes

- **Dependencies**: None
- **Task Independence**: Can be done independently

## Related Tasks

- Previous: TASK-1.1.4
- Next: TASK-1.1.6
- Dependencies: None
- Related: All HTTP endpoint test tasks will use this helper

## Definition of Done

**Definition of Done**: 
1. `assertErrorResponse()` implemented
2. Unit tests written and passing
3. All checks pass
4. Code committed and pushed to origin

**User Stories**:
- As a **test developer**, I want an error response assertion helper so I can validate errors consistently
- As a **test developer**, I want helpful error messages so I can debug test failures quickly

**Automated Tests**:
- Tests verify validation logic
- Tests verify helpful error messages
- All tests pass








